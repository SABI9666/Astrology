<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0d0618">
    <title>Celestial Oracle | ‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Sans:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --gold-light: #F4E4BC; --midnight: #0d0618; --purple: #1a0a2e; --violet: #7b5ea7; --white: #f8f4ff; --green: #4CAF50; --whatsapp: #25D366; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans', sans-serif; background: var(--midnight); color: var(--white); min-height: 100vh; }
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%; animation: twinkle 3s ease-in-out infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .container { position: relative; z-index: 10; max-width: 550px; margin: 0 auto; padding: 30px 16px; }
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { font-family: 'Cinzel', serif; color: var(--gold); font-size: 1.7rem; letter-spacing: 0.1em; text-shadow: 0 0 20px rgba(212,175,55,0.5); }
        .header p { color: var(--gold-light); opacity: 0.8; margin-top: 5px; }
        .card { background: linear-gradient(145deg, rgba(26,10,46,0.95), rgba(13,6,24,0.98)); border: 1px solid rgba(212,175,55,0.3); border-radius: 16px; padding: 25px 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.5); }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-family: 'Cinzel', serif; font-size: 0.7rem; color: var(--gold); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.1em; }
        .form-input, .form-select { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(212,175,55,0.25); border-radius: 10px; color: var(--white); font-size: 16px; }
        .form-select option { background: var(--purple); }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--gold); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
        .tag { padding: 8px 12px; background: rgba(123,94,167,0.15); border: 1px solid rgba(123,94,167,0.3); border-radius: 20px; color: var(--violet); font-size: 0.8rem; cursor: pointer; }
        .tag.active { background: var(--violet); color: white; }
        textarea { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(212,175,55,0.25); border-radius: 10px; color: var(--white); font-size: 15px; min-height: 60px; resize: vertical; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-family: 'Cinzel', serif; font-size: 0.95rem; cursor: pointer; margin-top: 10px; }
        .btn:active { transform: scale(0.98); }
        .btn-gold { background: linear-gradient(135deg, var(--gold), #c9a227); color: var(--midnight); font-weight: 600; }
        .loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13,6,24,0.97); z-index: 100; justify-content: center; align-items: center; flex-direction: column; }
        .loading.active { display: flex; }
        .spinner { width: 60px; height: 60px; border: 3px solid rgba(212,175,55,0.2); border-top-color: var(--gold); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading p { margin-top: 20px; color: var(--gold); font-family: 'Cinzel', serif; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13,6,24,0.98); z-index: 200; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-card { background: linear-gradient(145deg, rgba(26,10,46,0.98), rgba(13,6,24,0.99)); border: 1px solid rgba(212,175,55,0.3); border-radius: 20px; padding: 30px 25px; max-width: 400px; width: 100%; text-align: center; }
        .modal-icon { font-size: 3rem; margin-bottom: 10px; }
        .modal-title { font-family: 'Cinzel', serif; color: var(--gold); font-size: 1.2rem; margin-bottom: 5px; }
        .amount { font-size: 2.5rem; font-weight: 700; color: var(--green); margin: 15px 0; }
        .info-box { background: rgba(37,211,102,0.1); border: 1px solid rgba(37,211,102,0.3); border-radius: 10px; padding: 15px; margin: 15px 0; font-size: 0.85rem; color: #a5d6a7; line-height: 1.6; }
        .verify-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--gold), #c9a227); border: none; border-radius: 10px; color: #000; font-family: 'Cinzel', serif; font-size: 1rem; font-weight: 600; cursor: pointer; text-decoration: none; display: block; text-align: center; }
        .cancel-btn { width: 100%; padding: 12px; background: transparent; border: 1px solid rgba(255,100,100,0.4); border-radius: 10px; color: #ff9999; font-size: 0.85rem; cursor: pointer; margin-top: 10px; }
        .success-icon { font-size: 4rem; margin-bottom: 15px; }
        .steps-list { text-align: left; background: rgba(0,0,0,0.2); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .step { display: flex; gap: 12px; margin: 12px 0; align-items: flex-start; }
        .step-num { width: 28px; height: 28px; background: var(--gold); color: var(--midnight); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; flex-shrink: 0; }
        .step-text { font-size: 0.9rem; line-height: 1.5; }
        .error { background: rgba(244,67,54,0.2); border: 1px solid rgba(244,67,54,0.5); border-radius: 10px; padding: 12px; color: #ff9999; margin-top: 15px; display: none; text-align: center; }
        .error.active { display: block; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(26,10,46,0.95); border: 1px solid var(--gold); border-radius: 8px; padding: 10px 20px; color: var(--gold); z-index: 300; opacity: 0; transition: all 0.3s; }
        .toast.active { transform: translateX(-50%) translateY(0); opacity: 1; }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="loading" id="loading"><div class="spinner"></div><p id="loadingText">Consulting the Stars...</p></div>
    <div class="toast" id="toast"></div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-card">
            <div class="modal-icon">üîÆ</div>
            <h2 class="modal-title">Complete Payment</h2>
            <div class="amount" id="amount">‚Çπ100</div>
            <div class="info-box">Pay via any UPI app (GPay, PhonePe, Paytm)<br>UPI ID will be copied automatically!</div>
            <a href="#" class="verify-btn" id="payNowBtn">üí≥ Proceed to Pay</a>
            <button class="cancel-btn" id="cancelBtn">Cancel</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-card">
            <div class="success-icon">‚úÖ</div>
            <h2 class="modal-title">Request Sent!</h2>
            <div class="info-box">Your verification request has been sent via WhatsApp!</div>
            <div class="steps-list">
                <div class="step"><span class="step-num">1</span><span class="step-text">Make sure you <strong>send</strong> the WhatsApp message</span></div>
                <div class="step"><span class="step-num">2</span><span class="step-text">Admin will verify your payment</span></div>
                <div class="step"><span class="step-num">3</span><span class="step-text">You'll receive <strong>reading link + PDF</strong> on WhatsApp</span></div>
            </div>
            <button class="verify-btn" id="resendBtn" style="background: linear-gradient(135deg, #25D366, #128C7E); color: #fff;">üì± Resend WhatsApp Message</button>
            <button class="cancel-btn" id="newRequestBtn">‚Üê Start New Request</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>‚ú® CELESTIAL ORACLE</h1>
            <p>‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑ | Jyotish | ‡¥ú‡µç‡¥Ø‡µã‡¥§‡¥ø‡¥∑‡¥Ç</p>
        </div>
        <div class="card">
            <form id="mainForm">
                <div class="form-group">
                    <label class="form-label">üåê Language</label>
                    <select id="language" class="form-select">
                        <option value="english">English</option>
                        <option value="hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                        <option value="tamil">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                        <option value="telugu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                        <option value="malayalam">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
                        <option value="kannada">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                        <option value="bengali">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                        <option value="marathi">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                        <option value="gujarati">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                        <option value="punjabi">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" id="name" class="form-input" placeholder="Enter your name" required maxlength="50">
                </div>
                <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select id="gender" class="form-select">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" id="dob" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time of Birth</label>
                        <input type="time" id="tob" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Place of Birth</label>
                    <input type="text" id="pob" class="form-input" placeholder="City, State, Country" required maxlength="100">
                </div>
                <div class="form-group">
                    <label class="form-label">üîÆ What do you want to know?</label>
                    <div class="tags" id="tags">
                        <span class="tag" data-q="marriage">üíç Marriage</span>
                        <span class="tag" data-q="job">üíº Job</span>
                        <span class="tag" data-q="career">üìà Career</span>
                        <span class="tag" data-q="wealth">üí∞ Wealth</span>
                        <span class="tag" data-q="health">üè• Health</span>
                        <span class="tag" data-q="love">‚ù§Ô∏è Love</span>
                        <span class="tag" data-q="education">üìö Education</span>
                        <span class="tag" data-q="children">üë∂ Children</span>
                        <span class="tag" data-q="foreign">‚úàÔ∏è Foreign</span>
                        <span class="tag" data-q="business">üè™ Business</span>
                    </div>
                    <textarea id="customQ" placeholder="Or type your specific question..."></textarea>
                </div>
                <button type="submit" class="btn btn-gold">üîÆ Get My Reading</button>
                <div class="error" id="error"></div>
            </form>
        </div>
    </div>

<script>
var selectedTags = [];
var whatsappUrl = null;
var questionMap = { marriage: "Marriage predictions", job: "Job predictions", career: "Career growth", wealth: "Wealth prospects", health: "Health predictions", love: "Love life", education: "Education success", children: "Children predictions", foreign: "Foreign travel", business: "Business success" };

// Stars
(function() { var c = document.getElementById('stars'); for (var i = 0; i < 80; i++) { var s = document.createElement('div'); s.className = 'star'; s.style.left = Math.random() * 100 + '%'; s.style.top = Math.random() * 100 + '%'; s.style.animationDelay = Math.random() * 3 + 's'; c.appendChild(s); } })();

document.getElementById('dob').max = new Date().toISOString().split('T')[0];

// Tags
document.querySelectorAll('.tag').forEach(function(tag) {
    tag.onclick = function() {
        this.classList.toggle('active');
        var q = this.dataset.q;
        if (this.classList.contains('active')) { if (selectedTags.indexOf(q) === -1) selectedTags.push(q); }
        else { selectedTags = selectedTags.filter(function(t) { return t !== q; }); }
    };
});

function showToast(msg) { var t = document.getElementById('toast'); t.textContent = msg; t.classList.add('active'); setTimeout(function() { t.classList.remove('active'); }, 3000); }
function showError(msg) { var e = document.getElementById('error'); e.textContent = msg; e.classList.add('active'); setTimeout(function() { e.classList.remove('active'); }, 5000); }

// Check if returning from payment
(function() {
    var params = new URLSearchParams(window.location.search);
    if (params.get('verify') === '1') {
        // Clear URL
        window.history.replaceState({}, '', '/');
        
        // Get stored user data
        var stored = sessionStorage.getItem('celestial_user');
        if (stored) {
            var userData = JSON.parse(stored);
            sendVerification(userData);
        } else {
            showToast('Session expired. Please fill form again.');
        }
    }
})();

function sendVerification(userData) {
    document.getElementById('loading').classList.add('active');
    document.getElementById('loadingText').textContent = 'Sending to WhatsApp...';

    fetch('/api/verify-request', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
    })
    .then(function(res) { return res.json(); })
    .then(function(result) {
        if (!result.success) throw new Error(result.message || 'Failed');
        whatsappUrl = result.data.whatsappUrl;
        window.open(whatsappUrl, '_blank');
        document.getElementById('loading').classList.remove('active');
        document.getElementById('successModal').classList.add('active');
        showToast('WhatsApp opened!');
    })
    .catch(function(err) {
        document.getElementById('loading').classList.remove('active');
        showError(err.message || 'Error');
    });
}

// Form submit
document.getElementById('mainForm').onsubmit = function(e) {
    e.preventDefault();
    var name = document.getElementById('name').value.trim();
    var dob = document.getElementById('dob').value;
    var tob = document.getElementById('tob').value;
    var pob = document.getElementById('pob').value.trim();
    if (!name || !dob || !tob || !pob) { showError('Please fill all fields'); return; }

    var questions = selectedTags.map(function(t) { return questionMap[t] || ''; }).join(', ');
    var customQ = document.getElementById('customQ').value.trim();
    if (customQ) questions += (questions ? '. ' : '') + customQ;
    if (!questions) questions = 'Complete life reading';

    var userData = { name: name, birthDate: dob, birthTime: tob, birthPlace: pob, language: document.getElementById('language').value, gender: document.getElementById('gender').value, questions: questions };

    // Store in sessionStorage for after payment
    sessionStorage.setItem('celestial_user', JSON.stringify(userData));

    document.getElementById('loading').classList.add('active');
    document.getElementById('loadingText').textContent = 'Preparing payment...';

    fetch('/api/payment')
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (!data.success) throw new Error(data.message);
            document.getElementById('amount').textContent = '‚Çπ' + data.data.amount;
            document.getElementById('payNowBtn').href = data.data.urls.upi;
            document.getElementById('loading').classList.remove('active');
            document.getElementById('paymentModal').classList.add('active');
        })
        .catch(function(err) {
            document.getElementById('loading').classList.remove('active');
            showError(err.message || 'Payment error');
        });
};

document.getElementById('cancelBtn').onclick = function() { document.getElementById('paymentModal').classList.remove('active'); };
document.getElementById('resendBtn').onclick = function() { if (whatsappUrl) { window.open(whatsappUrl, '_blank'); showToast('WhatsApp opened!'); } };
document.getElementById('newRequestBtn').onclick = function() {
    document.getElementById('successModal').classList.remove('active');
    document.getElementById('mainForm').reset();
    selectedTags = [];
    document.querySelectorAll('.tag').forEach(function(t) { t.classList.remove('active'); });
    sessionStorage.removeItem('celestial_user');
    whatsappUrl = null;
};
</script>
</body>
</html>










