<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0d0618">
    <title>Celestial Oracle | ‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Sans:wght@400;500&display=swap" rel="stylesheet">
    <!-- Razorpay Checkout Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        :root { --gold: #D4AF37; --gold-light: #F4E4BC; --midnight: #0d0618; --purple: #1a0a2e; --violet: #7b5ea7; --white: #f8f4ff; --green: #4CAF50; --whatsapp: #25D366; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans', sans-serif; background: var(--midnight); color: var(--white); min-height: 100vh; }
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%; animation: twinkle 3s ease-in-out infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .container { position: relative; z-index: 10; max-width: 550px; margin: 0 auto; padding: 30px 16px; }
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { font-family: 'Cinzel', serif; color: var(--gold); font-size: 1.7rem; letter-spacing: 0.1em; text-shadow: 0 0 20px rgba(212,175,55,0.5); }
        .header p { color: var(--gold-light); opacity: 0.8; margin-top: 5px; }
        .card { background: linear-gradient(145deg, rgba(26,10,46,0.95), rgba(13,6,24,0.98)); border: 1px solid rgba(212,175,55,0.3); border-radius: 16px; padding: 25px 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.5); }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-family: 'Cinzel', serif; font-size: 0.7rem; color: var(--gold); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.1em; }
        .form-input, .form-select { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(212,175,55,0.25); border-radius: 10px; color: var(--white); font-size: 16px; }
        .form-select option { background: var(--purple); }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--gold); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
        .tag { padding: 8px 12px; background: rgba(123,94,167,0.15); border: 1px solid rgba(123,94,167,0.3); border-radius: 20px; color: var(--violet); font-size: 0.8rem; cursor: pointer; transition: all 0.2s; }
        .tag.active { background: var(--violet); color: white; }
        textarea { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(212,175,55,0.25); border-radius: 10px; color: var(--white); font-size: 15px; min-height: 60px; resize: vertical; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-family: 'Cinzel', serif; font-size: 0.95rem; cursor: pointer; margin-top: 10px; transition: transform 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-gold { background: linear-gradient(135deg, var(--gold), #c9a227); color: var(--midnight); font-weight: 600; }
        .loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13,6,24,0.97); z-index: 100; justify-content: center; align-items: center; flex-direction: column; }
        .loading.active { display: flex; }
        .spinner { width: 60px; height: 60px; border: 3px solid rgba(212,175,55,0.2); border-top-color: var(--gold); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading p { margin-top: 20px; color: var(--gold); font-family: 'Cinzel', serif; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13,6,24,0.98); z-index: 200; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-card { background: linear-gradient(145deg, rgba(26,10,46,0.98), rgba(13,6,24,0.99)); border: 1px solid rgba(212,175,55,0.3); border-radius: 20px; padding: 30px 25px; max-width: 400px; width: 100%; text-align: center; }
        .modal-icon { font-size: 3rem; margin-bottom: 10px; }
        .modal-title { font-family: 'Cinzel', serif; color: var(--gold); font-size: 1.2rem; margin-bottom: 5px; }
        .amount { font-size: 2.5rem; font-weight: 700; color: var(--green); margin: 15px 0; }
        .info-box { background: rgba(76,175,80,0.1); border: 1px solid rgba(76,175,80,0.3); border-radius: 10px; padding: 15px; margin: 15px 0; font-size: 0.85rem; color: #a5d6a7; line-height: 1.6; }
        .payment-btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; margin: 10px 0; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .payment-btn.razorpay { background: #2196F3; color: white; }
        .payment-btn:active { transform: scale(0.98); }
        .cancel-btn { width: 100%; padding: 12px; background: transparent; border: 1px solid rgba(255,100,100,0.4); border-radius: 10px; color: #ff9999; font-size: 0.85rem; cursor: pointer; margin-top: 10px; }
        .success-icon { font-size: 4rem; margin-bottom: 15px; }
        .error { background: rgba(244,67,54,0.2); border: 1px solid rgba(244,67,54,0.5); border-radius: 10px; padding: 12px; color: #ff9999; margin-top: 15px; display: none; text-align: center; }
        .error.active { display: block; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(26,10,46,0.95); border: 1px solid var(--gold); border-radius: 8px; padding: 10px 20px; color: var(--gold); z-index: 300; opacity: 0; transition: all 0.3s; }
        .toast.active { transform: translateX(-50%) translateY(0); opacity: 1; }
        .secure-badge { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 15px; font-size: 0.75rem; color: #888; }
        .reading-link { display: block; padding: 16px; background: linear-gradient(135deg, #4CAF50, #388E3C); color: white; text-decoration: none; border-radius: 10px; font-weight: 600; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="loading" id="loading"><div class="spinner"></div><p id="loadingText">Consulting the Stars...</p></div>
    <div class="toast" id="toast"></div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-card">
            <div class="modal-icon">üîÆ</div>
            <h2 class="modal-title">Complete Payment</h2>
            <div class="amount" id="amount">‚Çπ100</div>
            <div class="info-box">
                ‚úÖ Secure payment via Razorpay<br>
                ‚úÖ GPay, PhonePe, UPI, Cards accepted<br>
                ‚úÖ Instant reading after payment
            </div>
            <button class="payment-btn razorpay" id="payNowBtn">
                üí≥ Pay Now - Secure Checkout
            </button>
            <div class="secure-badge">
                üîí Secured by Razorpay
            </div>
            <button class="cancel-btn" id="cancelBtn">Cancel</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-card">
            <div class="success-icon">‚úÖ</div>
            <h2 class="modal-title">Payment Successful!</h2>
            <div class="info-box">Your personalized reading is ready!</div>
            <a href="#" class="reading-link" id="readingLink">üìñ View Your Reading</a>
            <button class="cancel-btn" id="newRequestBtn">‚Üê Get Another Reading</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>‚ú® CELESTIAL ORACLE</h1>
            <p>‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑ | Jyotish | ‡¥ú‡µç‡¥Ø‡µã‡¥§‡¥ø‡¥∑‡¥Ç</p>
        </div>
        <div class="card">
            <form id="mainForm">
                <div class="form-group">
                    <label class="form-label">üåê Language</label>
                    <select id="language" class="form-select">
                        <option value="english">English</option>
                        <option value="hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                        <option value="tamil">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                        <option value="telugu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                        <option value="malayalam">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
                        <option value="kannada">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                        <option value="bengali">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                        <option value="marathi">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                        <option value="gujarati">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                        <option value="punjabi">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" id="name" class="form-input" placeholder="Enter your name" required maxlength="50">
                </div>
                <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select id="gender" class="form-select">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" id="dob" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time of Birth</label>
                        <input type="time" id="tob" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Place of Birth</label>
                    <input type="text" id="pob" class="form-input" placeholder="City, State, Country" required maxlength="100">
                </div>
                <div class="form-group">
                    <label class="form-label">What would you like to know?</label>
                    <div class="tags">
                        <span class="tag" data-q="marriage">üíç Marriage</span>
                        <span class="tag" data-q="job">üíº Job</span>
                        <span class="tag" data-q="career">üìà Career</span>
                        <span class="tag" data-q="wealth">üí∞ Wealth</span>
                        <span class="tag" data-q="health">‚ù§Ô∏è Health</span>
                        <span class="tag" data-q="love">üíï Love</span>
                        <span class="tag" data-q="education">üìö Education</span>
                        <span class="tag" data-q="children">üë∂ Children</span>
                        <span class="tag" data-q="foreign">‚úàÔ∏è Foreign</span>
                        <span class="tag" data-q="business">üè¢ Business</span>
                    </div>
                    <textarea id="customQ" placeholder="Any specific questions? (optional)" maxlength="300"></textarea>
                </div>
                <button type="submit" class="btn btn-gold">üîÆ Get My Reading - ‚Çπ100</button>
                <div class="error" id="error"></div>
            </form>
        </div>
    </div>

<script>
var selectedTags = [];
var userData = null;
var orderData = null;
var questionMap = { 
    marriage: "Marriage predictions", 
    job: "Job predictions", 
    career: "Career growth", 
    wealth: "Wealth prospects", 
    health: "Health predictions", 
    love: "Love life", 
    education: "Education success", 
    children: "Children predictions", 
    foreign: "Foreign travel", 
    business: "Business success" 
};

// Create stars
(function() { 
    var c = document.getElementById('stars'); 
    for (var i = 0; i < 80; i++) { 
        var s = document.createElement('div'); 
        s.className = 'star'; 
        s.style.left = Math.random() * 100 + '%'; 
        s.style.top = Math.random() * 100 + '%'; 
        s.style.animationDelay = Math.random() * 3 + 's'; 
        c.appendChild(s); 
    } 
})();

document.getElementById('dob').max = new Date().toISOString().split('T')[0];

// Tags
document.querySelectorAll('.tag').forEach(function(tag) {
    tag.onclick = function() {
        this.classList.toggle('active');
        var q = this.dataset.q;
        if (this.classList.contains('active')) { 
            if (selectedTags.indexOf(q) === -1) selectedTags.push(q); 
        } else { 
            selectedTags = selectedTags.filter(function(t) { return t !== q; }); 
        }
    };
});

function showToast(msg) { 
    var t = document.getElementById('toast'); 
    t.textContent = msg; 
    t.classList.add('active'); 
    setTimeout(function() { t.classList.remove('active'); }, 3000); 
}

function showError(msg) { 
    var e = document.getElementById('error'); 
    e.textContent = msg; 
    e.classList.add('active'); 
    setTimeout(function() { e.classList.remove('active'); }, 5000); 
}

function showLoading(text) {
    document.getElementById('loadingText').textContent = text || 'Please wait...';
    document.getElementById('loading').classList.add('active');
}

function hideLoading() {
    document.getElementById('loading').classList.remove('active');
}

// Form submit - Create order
document.getElementById('mainForm').onsubmit = function(e) {
    e.preventDefault();
    
    var name = document.getElementById('name').value.trim();
    var dob = document.getElementById('dob').value;
    var tob = document.getElementById('tob').value;
    var pob = document.getElementById('pob').value.trim();
    
    if (!name || !dob || !tob || !pob) { 
        showError('Please fill all fields'); 
        return; 
    }

    var questions = selectedTags.map(function(t) { return questionMap[t] || ''; }).join(', ');
    var customQ = document.getElementById('customQ').value.trim();
    if (customQ) questions += (questions ? '. ' : '') + customQ;
    if (!questions) questions = 'Complete life reading';

    userData = { 
        name: name, 
        birthDate: dob, 
        birthTime: tob, 
        birthPlace: pob, 
        language: document.getElementById('language').value, 
        gender: document.getElementById('gender').value, 
        questions: questions 
    };

    showLoading('Creating order...');

    // Create Razorpay order
    fetch('/api/create-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
    })
    .then(function(res) { return res.json(); })
    .then(function(data) {
        hideLoading();
        if (!data.success) throw new Error(data.message);
        
        orderData = data.data;
        document.getElementById('amount').textContent = '‚Çπ' + orderData.amount;
        document.getElementById('paymentModal').classList.add('active');
    })
    .catch(function(err) {
        hideLoading();
        showError(err.message || 'Failed to create order');
    });
};

// Pay Now button - Open Razorpay
document.getElementById('payNowBtn').onclick = function() {
    if (!orderData) return;

    var options = {
        key: orderData.keyId,
        amount: orderData.amount * 100,
        currency: orderData.currency,
        name: 'Celestial Oracle',
        description: orderData.description,
        order_id: orderData.orderId,
        prefill: {
            name: userData.name
        },
        theme: {
            color: '#D4AF37'
        },
        handler: function(response) {
            // Payment successful - verify and get reading
            document.getElementById('paymentModal').classList.remove('active');
            showLoading('Verifying payment & generating reading...');

            fetch('/api/verify-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    razorpay_order_id: response.razorpay_order_id,
                    razorpay_payment_id: response.razorpay_payment_id,
                    razorpay_signature: response.razorpay_signature,
                    userData: userData
                })
            })
            .then(function(res) { return res.json(); })
            .then(function(data) {
                hideLoading();
                if (!data.success) throw new Error(data.message);
                
                // Show success modal with reading link
                document.getElementById('readingLink').href = data.data.readingUrl;
                document.getElementById('successModal').classList.add('active');
                showToast('Payment successful!');
            })
            .catch(function(err) {
                hideLoading();
                showError(err.message || 'Verification failed');
            });
        },
        modal: {
            ondismiss: function() {
                showToast('Payment cancelled');
            }
        }
    };

    var rzp = new Razorpay(options);
    rzp.open();
};

// Cancel button
document.getElementById('cancelBtn').onclick = function() { 
    document.getElementById('paymentModal').classList.remove('active'); 
};

// New request button
document.getElementById('newRequestBtn').onclick = function() {
    document.getElementById('successModal').classList.remove('active');
    document.getElementById('mainForm').reset();
    selectedTags = [];
    document.querySelectorAll('.tag').forEach(function(t) { t.classList.remove('active'); });
    userData = null;
    orderData = null;
};
</script>
</body>
</html>
















